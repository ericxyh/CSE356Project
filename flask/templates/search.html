<html>
<head>
<script>

//change thing to more visible form
function postChange(i){
	var ans = "";
	ans += i.id + ", Posted by "+i.username+" at "+i.timestamp+"<br>";
	ans += i.content+"<br>";
	ans += "Likes:" + i.property.likes + " Retweets: " + i.retweeted 
	return ans;
}

function userChange(u){
	var ans = "";
	return ans;
}

function singleSearch(){
	document.getElementById("result").innerHTML = ""
	var it  = document.getElementById("pid").value;
	if (it === ''){
		document.getElementById("result").innerHTML = 'Please enter ID'
	}
	else{
		var request = new XMLHttpRequest();
		request.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200||this.readyState == 4 && this.status == 500){
				var results = JSON.parse(request.responseText);
				if(results.status === "OK")
					document.getElementById("result").innerHTML = postChange(results.item) +"<br>"
				if(results.status === "error")
					document.getElementById("result").innerHTML = results.error
			}
		}
		request.open("GET", "/item/"+it,true);
		request.send();
	}
}

function multiSearch(){
	document.getElementById("result").innerHTML = ""
	var json = {};
	var t = document.getElementById("time").value;
	var l = document.getElementById("num").value;
	var q = document.getElementById("q").value;
	var u = document.getElementById("uname").value;
	if (t!=""){
		json.timestamp = parseInt(t);
	}
	if (l!=""){
		json.limit = parseInt(l);
	}
	if (q!=""){
		json.q = q;
	}
	if (u!=""){
		json.username = u;
	}
	if ("{{login}}"){
		json.following = document.getElementById("following").value;
	}
	else{
		json.following = false
	}
	var request = new XMLHttpRequest();
	request.onreadystatechange = function(){
		if(this.readyState == 4 && this.status == 200||this.readyState == 4 && this.status == 500){
			var results = JSON.parse(request.responseText);
			if(results.status === "OK"){
				var res = "";
				if (results.items.length == 0){
					document.getElementById("result").innerHTML = 'No items found'
				}
				else{
					for (var i = 0; i < results.items.length; i++){
						res += postChange(results.items[i]) +"<br><br>";
					}
					document.getElementById("result").innerHTML = res;
				}
			}
			if(results.status === "error")
				document.getElementById("result").innerHTML = results.error;
		}
	}
	request.open("POST", "/search",true);
	request.setRequestHeader("Content-Type","application/json");
	request.send(JSON.stringify(json));
}

function userSearch(){
	document.getElementById("result").innerHTML = ""
	var it  = document.getElementById("uid").value;
	if (it === ''){
		document.getElementById("result").innerHTML = 'Please enter ID';
	}
	else{
		var request = new XMLHttpRequest();
		request.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200||this.readyState == 4 && this.status == 500){
				var results = JSON.parse(request.responseText);
				if(results.status === "OK")
					document.getElementById("result").innerHTML = results.user +"<br>"
				if(results.status === "error")
					document.getElementById("result").innerHTML = results.error
			}
		}
		request.open("GET", "/user/"+it,true);
		request.send();
	}
}

</script>
</head>
<body>

<h3><a href="/">Back</a></h3><br>

post id:<br>
<input type="text" id="pid">
<br>
<button onclick="singleSearch()">Post Search</button>
<br><br>
unix time:<br>
<input type="number" id="time">
<br>
number:<br>
<input type="number" min="1" max="100" id="num">
<br>
query:<br>
<input type="text" id="q">
<br>
Posted by:<br>
<input type="text" id="uname">
<br>
{% if login %}
following:
<input type="checkbox" id="following" checked>
{% endif %}
<br>
<button onclick="multiSearch()">GroupSearch</button>
<br><br>
user id:<br>
<input type="text" id="uid">
<br>
<button onclick="userSearch()">User Search</button>
<br>
<h1>FINISH USER INFO SEARCH (follow, lists)</h1>
<h3>Result:</h3>
<br>
<div id="result"></div>
<div id="result2"></div>
</body>
</html>
